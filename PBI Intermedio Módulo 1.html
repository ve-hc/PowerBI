<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M칩dulo I: Lenguaje DAX</title>
    <style>
        :root {
            --primary-color: #F2C811; /* Amarillo Power BI */
            --secondary-color: #2A2E30; /* Gris oscuro Power BI */
            --text-color: #333;
            --bg-color: #f8f9fa;
            --card-bg-color: #ffffff;
            --border-color: #dee2e6;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --code-font-family: 'Consolas', 'Courier New', Courier, monospace;
        }

        body {
            font-family: var(--font-family);
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background-color: var(--secondary-color);
            color: white;
            padding: 1.5em 2em;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        header h1 {
            margin: 0;
            font-size: 2em;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        header h1 svg {
            margin-right: 15px;
            width: 40px;
            height: 40px;
            fill: var(--primary-color);
        }

        nav {
            background-color: var(--card-bg-color);
            padding: 1em 0;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            overflow-x: auto; 
            white-space: nowrap; 
        }

        nav ul {
            list-style: none;
            padding: 0 1em; 
            margin: 0;
            display: flex;
            flex-wrap: nowrap; 
        }

        nav li {
            margin: 0.5em 0.8em; 
            flex-shrink: 0; 
        }

        nav a {
            text-decoration: none;
            color: var(--secondary-color);
            font-weight: bold;
            padding: 0.5em 1em;
            border-radius: 5px;
            transition: background-color 0.3s, color 0.3s;
            display: flex;
            align-items: center;
            font-size: 0.9em; 
        }
        nav a svg {
            width: 18px; 
            height: 18px;
            margin-right: 6px;
            fill: var(--secondary-color);
            transition: fill 0.3s;
        }
        nav a:hover, nav a.active-nav {
            background-color: var(--primary-color);
            color: var(--secondary-color);
        }
        
        nav a:hover svg, nav a.active-nav svg {
            fill: var(--secondary-color);
        }
        main {
            flex-grow: 1;
            padding: 2em;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }

        .pagina {
            display: none;
            background-color: var(--card-bg-color);
            padding: 2em;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            animation: fadeIn 0.5s ease-in-out;
        }

        .pagina.activa {
            display: block;
        }        
                main {
            flex-grow: 1;
            padding: 2em;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }

        .pagina {
            display: none;
            background-color: var(--card-bg-color);
            padding: 2em;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            animation: fadeIn 0.5s ease-in-out;
        }

        .pagina.activa {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pagina h2 {
            color: var(--secondary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5em;
            margin-top: 0;
            display: flex;
            align-items: center;
            font-size: 1.8em;
        }
        
        .pagina h2 svg {
            width: 28px;
            height: 28px;
            margin-right: 10px;
            fill: var(--secondary-color);
        }

        .pagina h3 {
            color: var(--secondary-color);
            opacity: 0.9;
            margin-top: 1.5em;
            font-size: 1.4em;
        }
        
        .pagina h4 {
            color: var(--primary-color);
            margin-top: 1.2em;
            font-size: 1.1em;
        }

        p, li {
            font-size: 1.05em;
            margin-bottom: 1em;
        }

        ul, ol {
            padding-left: 20px;
        }
        .tip {
            background-color: #fff8e1; 
            border-left: 5px solid var(--primary-color);
            padding: 1em;
            margin: 1.5em 0;
            border-radius: 4px;
        }
        .tip strong { color: var(--primary-color); opacity: 0.8;}

        .warning {
            background-color: #fce4ec; 
            border-left: 5px solid #e91e63; 
            padding: 1em;
            margin: 1.5em 0;
            border-radius: 4px;
        }
        .warning strong { color: #c2185b; }

        .quiz-container { margin-top: 2em; }
        .question-block { margin-bottom: 2em; padding: 1.5em; border: 1px solid var(--border-color); border-radius: 6px; background-color: #fdfdff;}
        .question-block p { font-weight: bold; margin-bottom: 1em;}
        .options label { display: block; margin-bottom: 0.8em; padding: 0.8em; border-radius: 4px; background-color: #f0f0f0; cursor: pointer; transition: background-color 0.2s;}
        .options label:hover { background-color: #e0e0e0;}
        .options input[type="radio"] { margin-right: 10px; vertical-align: middle;}
        .feedback { padding: 0.8em; margin-top: 1em; border-radius: 4px; font-weight: bold; display: none; }
        .feedback.correct { background-color: #d4edda; color: var(--success-color); border: 1px solid #c3e6cb;}
        .feedback.incorrect { background-color: #f8d7da; color: var(--danger-color); border: 1px solid #f5c6cb;}
        #quiz-submit-btn { background-color: var(--primary-color); color: var(--secondary-color); border: none; padding: 0.8em 1.5em; font-size: 1.1em; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; display: block; margin: 2em auto 0; font-weight: bold;}
        #quiz-submit-btn:hover { background-color: #e0b000; }
        #quiz-result { margin-top: 1.5em; padding: 1em; text-align: center; font-size: 1.2em; font-weight: bold; border-radius: 5px;}
        #quiz-result.success { background-color: #d4edda; color: var(--success-color); }
        #quiz-result.fail { background-color: #f8d7da; color: var(--danger-color); }

        footer {
            text-align: center;
            padding: 1.5em;
            background-color: var(--secondary-color);
            color: #adb5bd;
            margin-top: auto;
            font-size: 0.9em;
        }
        footer .brand-name {
            color: var(--primary-color);
            font-weight: bold;
        }


        .icon { fill: currentColor; }
        
        @media print {
            body { font-size: 10pt; color: #000; background-color: #fff; }
            header, nav, footer, #quiz-submit-btn { display: none !important; } 
            main { padding: 0; max-width: 100%; box-shadow: none; }
            .pagina { display: block !important; box-shadow: none; border: none; padding: 1em 0; margin-bottom: 20px; page-break-after: always; }
            #portada { text-align: left; page-break-after: always; }
            #portada h2, #portada h3, #portada .brand-mention { text-align: center; }
            #portada .module-icon svg { display: block; margin-left: auto; margin-right: auto; }
            .pagina:last-child { page-break-after: auto; }
            .pagina h2 { font-size: 16pt; border-bottom: 1px solid #ccc; color: #000; }
            .pagina h2 svg { display: none; }
            section {
            background-color: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            h1, h2, h3 {
            color: #0056b3;
            }
            h2 {
            border-bottom: 2px solid #0056b3;
            padding-bottom: 10px;
            margin-top: 0;
            }
            h3 {
            color: #004085;
            }
            ul {
            list-style-type: disc;
            margin-left: 20px;
            }
            code {
            background-color: #e9e9e9;
            padding: 2px 4px;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            display: block;
            white-space: pre-wrap;
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            }
            pre {
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            }
            .note {
            background-color: #e6f2ff;
            border-left: 5px solid #0056b3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            }
            hr {
            border: 0;
            height: 1px;
            background: #ccc;
            margin: 30px 0;
            }
            .tip, .warning { border-left-width: 2px; padding: 0.5em; background-color: #f9f9f9; border-color: #ccc;}
            .quiz-container .question-block { page-break-inside: avoid; }
            .options label { background-color: #fff; border: 1px solid #ccc; }
            .quiz-container .feedback { 
                display: block !important; 
                background-color: #efefef !important; 
                color: #000 !important; 
                border: 1px dashed #bbb !important; 
                margin-top: 8px; 
                padding: 6px; 
                font-size: 9pt;
                font-weight: normal;
            }
             .quiz-container .feedback.correct, .quiz-container .feedback.incorrect { 
                background-color: #efefef !important;
                border: 1px dashed #bbb !important;
            }
            .quiz-container .feedback strong { font-weight: bold; }

            a { text-decoration: none; color: #000; }
            a[href^="http"]:after, a[href^="https"]:after { content: " (" attr(href) ")"; font-size: 0.8em; }
        }        
        
        
    </style>
</head>
<body>
    <header>
        <h1>
            <svg class="icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="40" height="40"><path d="M4 17.27V20h2.73L17.27 9.46l-2.73-2.73L4 17.27zM6.18 18H5v-1.18l8.04-8.04 1.18 1.18L6.18 18z"/><path d="M20.71 6.73l-2.44-2.44a.996.996 0 00-1.41 0l-1.83 1.83 2.73 2.73 1.83-1.83a.996.996 0 000-1.41zM4 4h2v10H4V4zm5 3h2v7H9V7zm5-2h2v9h-2V5z"/></svg>
            Power BI Nivel Intermedio
        </h1>
    </header>

    <nav>
        <ul>
            <li><a href="#" data-target="portada" class="active-nav">
                <svg class="icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
                Portada</a></li>
            <li><a href="#" data-target="contexto">
                <svg class="icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/></svg>
                Contextos</a></li>
            <li><a href="#" data-target="funcionesVariables">
                <svg class="icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></svg>
                Funciones y Variables</a></li>
            <li><a href="#" data-target="patronesDax">
                <svg class="icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7s2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"/></svg>
                Patrones DAX</a></li>
            <li><a href="#" data-target="tablaParametrica">
                <svg class="icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM7 15H5v-2h2v2zm0-4H5V9h2v2zm0-4H5V5h2v2zm4 8H9v-2h2v2zm0-4H9V9h2v2zm0-4H9V5h2v2zm5 10h-3V5h3v14zm2-14h-1V5h1v2zm0 4h-1V9h1v2zm0 4h-1v-2h1v2zM7 19v-2h2v2H7zm4 0v-2h2v2h-2z"/></svg>
                Tabla Param칠trica</a></li>
            <li><a href="#" data-target="totalAcumulado">
                <svg class="icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/></svg>
                Total Acumulado</a></li>
            <li><a href="#" data-target="clasificacionAbc">
                <svg class="icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M5 9.2h3V19H5zM10.6 5h2.8v14h-2.8zm5.6 8H19v6h-2.8z"/></svg>
                Clasificaci칩n ABC</a></li>
            <li><a href="#" data-target="calculosTiempo">
                <svg class="icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/></svg>
                C치lculos de Tiempo</a></li>
            <li><a href="#" data-target="quiz">
                <svg class="icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/></svg>
                Quiz Final</a></li>
        </ul>
    </nav>

    <main>
        <section id="portada" class="pagina activa">
            <div class="module-icon">
                
            </div>
            <h2>Power BI Nivel Intermedio</h2>
            <h3>M칩dulo I: Lenguaje DAX (Data Analysis Expressions) 游늵</h3>
            <p>춰Bienvenido/a al primer m칩dulo de nuestro curso de Power BI Nivel Intermedio!</p>
            <p>En este m칩dulo, nos sumergiremos en el coraz칩n de la inteligencia de negocio en Power BI: el lenguaje <strong>DAX</strong>. Aprender치s a ir m치s all치 de las visualizaciones b치sicas y a crear c치lculos personalizados, medidas complejas y an치lisis sofisticados que transformar치n tus datos en conocimiento accionable.</p>
            <p>Exploraremos desde los conceptos fundamentales como los contextos de evaluaci칩n, hasta patrones avanzados y funciones de inteligencia de tiempo. 춰Prep치rate para potenciar tus informes! 游</p>
            <div class="brand-mention">
                <p><strong>Reinventa Consultor칤a y Capacitaci칩n</strong></p>
            </div>
        </section>


        <section id="contexto" class="pagina">
            <h2>Contexto de Fila y Contexto de Filtro</h2>
            <p>El entendimiento de los contextos de fila y filtro es la base para dominar DAX. Son dos conceptos distintos pero que interact칰an constantemente.</p>

            <h3>Contexto de Fila (Row Context):</h3>
            <ul>
                <li><strong>Qu칠 es:</strong> Imagina que est치s recorriendo una tabla fila por fila. El contexto de fila opera sobre una 칰nica fila a la vez dentro de una tabla.</li>
                <li><strong>Cu치ndo se crea:</strong> Principalmente se crea al usar funciones iteradoras (como SUMX, AVERAGEX, FILTER, etc.) o al crear columnas calculadas. En una columna calculada, la f칩rmula se eval칰a para cada fila individualmente.</li>
                <li><strong>C칩mo funciona:</strong> Dentro de un contexto de fila, puedes referenciar directamente los valores de las columnas de esa fila espec칤fica. Por ejemplo, si tienes una tabla de 'Ventas' con columnas 'Cantidad' y 'Precio Unitario', en una columna calculada podr칤as escribir <code>[Cantidad] * [Precio Unitario]</code> y DAX sabr칤a que te refieres a los valores de la fila actual.</li>
                <li><strong>Ejemplo simple:</strong> Crear una columna calculada en una tabla de ventas llamada "Ingreso Total" con la f칩rmula:
                    <pre><code>='TablaVentas'[Cantidad] * 'TablaVentas'[PrecioUnitario]</code></pre>
                    Aqu칤, para cada fila, DAX toma la cantidad y el precio de esa fila.
                </li>
            </ul>

            <h3>Contexto de Filtro (Filter Context):</h3>
            <ul>
                <li><strong>Qu칠 es:</strong> Es el conjunto de filtros activos que se aplican a tus datos antes de que se eval칰e una medida o una expresi칩n DAX. Estos filtros pueden provenir de varias fuentes:
                    <ul>
                        <li>Filas y columnas en una tabla din치mica o visualizaci칩n.</li>
                        <li>Segmentaciones de datos (Slicers).</li>
                        <li>Otros filtros aplicados en el panel de filtros de Power BI.</li>
                        <li>Filtros dentro de otras medidas (usando CALCULATE por ejemplo).</li>
                    </ul>
                </li>
                <li><strong>Cu치ndo se crea:</strong> Se crea autom치ticamente por las interacciones en el informe (selecciones en gr치ficos, slicers) o expl칤citamente mediante funciones DAX como CALCULATE, FILTER, ALL, etc.</li>
                <li><strong>C칩mo funciona:</strong> El contexto de filtro reduce el subconjunto de datos sobre el cual se realizar치 el c치lculo. Por ejemplo, si seleccionas "A침o = 2023" en un slicer, el contexto de filtro para cualquier medida que uses ser치 solo sobre los datos de 2023.</li>
                <li><strong>Ejemplo simple:</strong> Una medida como:
                    <pre><code>Total Ventas = SUM('TablaVentas'[Ingreso Total])</code></pre>
                    Si pones esta medida en una tarjeta y tienes un slicer de "A침o" con "2023" seleccionado, la medida Total Ventas solo sumar치 los ingresos de las ventas del a침o 2023. El slicer define el contexto de filtro.
                </li>
            </ul>
            <p><strong>Interacci칩n Clave:</strong> La magia (y a veces la confusi칩n) de DAX ocurre cuando estos dos contextos interact칰an. Por ejemplo, una funci칩n iteradora como SUMX primero establece un contexto de fila para recorrer una tabla. Si esta tabla ya est치 siendo afectada por un contexto de filtro (por ejemplo, un slicer de a침o), SUMX solo recorrer치 las filas que cumplen con ese filtro. Adem치s, dentro de la expresi칩n de SUMX, puedes modificar el contexto de filtro usando CALCULATE.</p>
        </section>



        <section id="funcionesVariables" class="pagina">
            <h2>Uso de Funciones y Variables</h2>
            <h3>Funciones en DAX</h3>
            <p>Las funciones son el coraz칩n de DAX. Son f칩rmulas predefinidas que realizan c치lculos sobre los valores que se les proporcionan, conocidos como argumentos. DAX tiene una extensa biblioteca de funciones que cubren una amplia gama de necesidades:</p>
            <ol>
                <li><strong>Funciones de Agregaci칩n:</strong> SUM(), AVERAGE(), MIN(), MAX(), COUNT(), DISTINCTCOUNT()</li>
                <li><strong>Funciones L칩gicas:</strong> IF(), AND(), OR(), NOT(), SWITCH()</li>
                <li><strong>Funciones de Texto:</strong> CONCATENATE() o &, LEFT(), RIGHT(), MID(), LEN(), UPPER(), LOWER(), FORMAT(), FIND(), SEARCH()</li>
                <li><strong>Funciones de Fecha y Hora (Inteligencia de Tiempo):</strong> TODAY(), NOW(), YEAR(), MONTH(), DAY(), DATE(), DATEDIFF()</li>
                <li><strong>Funciones de Filtro y Valor:</strong> CALCULATE(), FILTER(), ALL(), RELATED(), LOOKUPVALUE()</li>
                <li><strong>Funciones de Tabla:</strong> FILTER(), ALL(), VALUES(), DISTINCT(), ADDCOLUMNS(), SUMMARIZE()</li>
                <li><strong>Funciones Iteradoras (funciones "X"):</strong> SUMX(), AVERAGEX(), MINX(), MAXX(), RANKX(), CONCATENATEX(), FILTER()</li>
            </ol>

            <h3>Variables en DAX (VAR ... RETURN)</h3>
            <p>Las variables son una herramienta extremadamente 칰til en DAX para mejorar la legibilidad, eficiencia y organizaci칩n de tus f칩rmulas, especialmente las m치s complejas.</p>
            <ul>
                <li><strong>Sintaxis:</strong>
                    <pre><code>NombreDeMedida =
VAR NombreVariable1 = Expresion1
VAR NombreVariable2 = Expresion2
-- Puedes declarar m칰ltiples variables
RETURN
    ExpresionFinalQueUsaLasVariables</code></pre>
                </li>
                <li><strong>Beneficios:</strong> Legibilidad, Eficiencia, Depuraci칩n, Reusabilidad (dentro de la misma medida).</li>
                <li><strong>Ejemplo:</strong> Imagina que quieres calcular la "Variaci칩n de Ventas A침o Anterior %":
                    <pre><code>Variacion Ventas AA % =
VAR VentasActuales = SUM('Ventas'[Importe])
VAR VentasAnioAnterior =
    CALCULATE(
        SUM('Ventas'[Importe]),
        SAMEPERIODLASTYEAR('Calendario'[Fecha])
    )
RETURN
    IF(
        NOT ISBLANK(VentasAnioAnterior),
        DIVIDE(VentasActuales - VentasAnioAnterior, VentasAnioAnterior),
        BLANK()
    )</code></pre>
                    Aqu칤, <strong>VentasActuales</strong> y <strong>VentasAnioAnterior</strong> son variables que almacenan c치lculos intermedios, haciendo la l칩gica de la expresi칩n RETURN mucho m치s clara y asegurando que cada c치lculo se realice solo una vez.
                </li>
            </ul>
            <div class="note">Esta secci칩n cubre los fundamentos del uso de funciones y variables en DAX. Son herramientas que usar치s constantemente.</div>
        </section>



        <section id="patronesDax" class="pagina">
            <h2>Patrones DAX</h2>
            <p>A medida que trabajas m치s con DAX, notar치s que ciertos tipos de c치lculos o problemas se resuelven de maneras similares repetidamente. Estas soluciones reutilizables y probadas se conocen como <strong>Patrones DAX</strong>. Comprender y utilizar estos patrones te ahorrar치 mucho tiempo, te ayudar치 a escribir c칩digo m치s eficiente y te permitir치 abordar problemas complejos con mayor confianza.</p>
            <p>Aqu칤 algunos de los patrones m치s importantes y utilizados:</p>

            <h3>1. C치lculos sobre un Periodo Anterior (Year-to-Date, Month-to-Date, Quarter-to-Date, Same Period Last Year):</h3>
            <ul>
                <li><strong>Ejemplo (Ventas Acumuladas en el A침o - YTD):</strong>
                    <pre><code>Ventas YTD = TOTALYTD(SUM('Ventas'[Importe]), 'Calendario'[Fecha])</code></pre>
                    O una versi칩n m치s expl칤cita y flexible usando CALCULATE y DATESYTD:
                    <pre><code>Ventas YTD (Calculate) =
CALCULATE(
    SUM('Ventas'[Importe]),
    DATESYTD('Calendario'[Fecha])
)</code></pre>
                </li>
                <li><strong>Ejemplo (Ventas Mismo Periodo A침o Anterior - SPLY):</strong>
                    <pre><code>Ventas SPLY =
CALCULATE(
    SUM('Ventas'[Importe]),
    SAMEPERIODLASTYEAR('Calendario'[Fecha])
)</code></pre>
                </li>
            </ul>

            <h3>2. Porcentaje del Total (Ratio to Parent, Ratio to Grand Total):</h3>
            <ul>
                <li><strong>Ejemplo (% del Total General de Ventas para una Categor칤a de Producto):</strong>
                    <pre><code>% Ventas sobre Total General =
DIVIDE(
    SUM('Ventas'[Importe]),
    CALCULATE(
        SUM('Ventas'[Importe]),
        ALL('Productos') // O ALL('Ventas') si quieres remover todos los filtros
    )
)</code></pre>
                </li>
            </ul>

            <h3>3. Promedios M칩viles (Moving Averages):</h3>
            <ul>
                <li><strong>Ejemplo (Promedio M칩vil de Ventas de 30 d칤as):</strong>
                    <pre><code>Ventas Promedio Movil 30D =
VAR FechaActual = MAX('Calendario'[Fecha])
VAR PeriodoTreintaDias =
    DATESINPERIOD(
        'Calendario'[Fecha],
        FechaActual,
        -30,
        DAY
    )
RETURN
    CALCULATE(
        AVERAGEX(PeriodoTreintaDias, SUM('Ventas'[Importe])),
        REMOVEFILTERS('Calendario') // O ALL('Calendario')
    )</code></pre>
                </li>
            </ul>

            <h3>4. Ranking:</h3>
            <ul>
                <li><strong>Ejemplo (Ranking de Productos por Ventas):</strong>
                    <pre><code>Ranking Producto por Ventas =
RANKX(
    ALLSELECTED('Productos'[NombreProducto]), // Tabla sobre la cual rankear
    CALCULATE(SUM('Ventas'[Importe])), // Expresi칩n a rankear
    , // Valor (opcional, usualmente se omite para usar la expresi칩n)
    DESC, // Orden (DESC para mayor a menor, ASC para menor a mayor)
    DENSE // Manejo de empates (DENSE o SKIP)
)</code></pre>
                </li>
            </ul>

            <h3>5. Segmentaci칩n Din치mica (Disconnected Slicers / What-if Parameters):</h3>
            <ul>
                <li><strong>Ejemplo (Ventas Top N Productos):</strong>
                    <pre><code>Ventas Top N Productos =
VAR NSeleccionado = SELECTEDVALUE('Parametro TopN'[Valor N], 5) // Default 5
VAR TablaTopNProductos = TOPN(NSeleccionado, VALUES('Productos'[NombreProducto]), CALCULATE(SUM('Ventas'[Importe])), DESC)
RETURN
    CALCULATE(
        SUM('Ventas'[Importe]),
        KEEPFILTERS(TablaTopNProductos)
    )</code></pre>
                </li>
            </ul>

            <h3>6. Manejo de Relaciones Muchos a Muchos (Many-to-Many):</h3>
            <p>Permite modelar escenarios de negocio m치s complejos utilizando una tabla puente y medidas que filtren correctamente a trav칠s de ella.</p>
            <div class="note">Los patrones DAX son como bloques de construcci칩n. Una vez que los conoces, puedes empezar a combinarlos para crear soluciones anal칤ticas muy sofisticadas.</div>
        </section>



        <section id="tablaParametrica" class="pagina">
            <h2>Tabla Param칠trica (Parameter Table)</h2>
            <p>Una <strong>tabla param칠trica</strong> es una tabla que creas en tu modelo de datos, pero que generalmente no tiene relaciones directas con tus tablas de hechos o dimensiones principales. Su prop칩sito es proporcionar una lista de valores que el usuario puede seleccionar para influir din치micamente en los c치lculos de tus medidas DAX o en la visualizaci칩n de datos.</p>

            <h3>쯇or qu칠 usar Tablas Param칠tricas?</h3>
            <ul>
                <li>Interactividad Mejorada</li>
                <li>Flexibilidad en C치lculos</li>
                <li>Simplificaci칩n de Medidas</li>
                <li>Escenarios "What-if"</li>
            </ul>

            <h3>쮺칩mo se crean y utilizan?</h3>
            <p>Existen varias formas de crear una tabla param칠trica:</p>
            <ol>
                <li><strong>Introducir Datos Manualmente (Enter Data):</strong> Para listas peque침as y fijas de opciones.</li>
                <li><strong>Usando DAX para generar una tabla (Nueva Tabla):</strong>
                    <ul>
                        <li>Ejemplo para crear una tabla con porcentajes del 0% al 100% en incrementos de 5%:
                            <pre><code>Tabla Parametrica Incremento % =
GENERATESERIES(0, 1, 0.05) // Genera una columna [Value]</code></pre>
                        </li>
                        <li>Ejemplo para una tabla de selecci칩n de medidas:
                            <pre><code>Tabla Seleccion Metrica =
DATATABLE (
    "ID Metrica", INTEGER,
    "Nombre Metrica", STRING,
    {
        { 1, "Ventas Totales" },
        { 2, "Costo Total" },
        { 3, "Beneficio Bruto" }
    }
)</code></pre>
                        </li>
                    </ul>
                </li>
                <li><strong>Desde un Origen Externo (Excel, SQL, etc.):</strong> Si los par치metros se gestionan externamente.</li>
            </ol>

            <h3>Uso en Medidas DAX:</h3>
            <p>La funci칩n principal es <strong>SELECTEDVALUE()</strong>.</p>
            <ul>
                <li><strong>Ejemplo 1: Cambiar la M칠trica Mostrada</strong>
                    <pre><code>Metrica Seleccionada =
VAR IdSeleccionado = SELECTEDVALUE('Tabla Seleccion Metrica'[ID Metrica])
RETURN
    SWITCH (
        TRUE(),
        IdSeleccionado = 1, SUM('Ventas'[Importe]),
        IdSeleccionado = 2, SUM('Ventas'[Costo]),
        IdSeleccionado = 3, SUM('Ventas'[Importe]) - SUM('Ventas'[Costo]),
        BLANK() // O una m칠trica por defecto
    )</code></pre>
                </li>
                <li><strong>Ejemplo 2: An치lisis "What-if" de Incremento de Ventas</strong>
                    <pre><code>Ventas Proyectadas =
VAR IncrementoSeleccionado = SELECTEDVALUE('Parametro Incremento %'[Value], 0) // Default 0%
VAR VentasActuales = SUM('Ventas'[Importe])
RETURN
    VentasActuales * (1 + IncrementoSeleccionado)</code></pre>
                </li>
                <li><strong>Ejemplo 3: Top N Din치mico (visto en Patrones DAX)</strong>
                    <pre><code>Ventas Top N Productos =
VAR NSeleccionado = SELECTEDVALUE('Parametro TopN'[Valor N], 5) // Default 5
VAR TablaTopNProductos = TOPN(NSeleccionado, VALUES('Productos'[NombreProducto]), CALCULATE(SUM('Ventas'[Importe])), DESC)
RETURN
    CALCULATE(
        SUM('Ventas'[Importe]),
        KEEPFILTERS(TablaTopNProductos)
    )</code></pre>
                </li>
            </ul>
            <div class="note">Las tablas param칠tricas son una t칠cnica poderosa para hacer tus informes de Power BI mucho m치s din치micos e interactivos, poniendo m치s control anal칤tico en manos del usuario final.</div>
        </section>



        <section id="totalAcumulado" class="pagina">
            <h2>Total Acumulado (Running Total)</h2>
            <p>Un <strong>total acumulado</strong>, tambi칠n conocido como total m칩vil o suma acumulada, es un c치lculo que muestra la suma de una m칠trica a lo largo del tiempo (o a lo largo de otra secuencia ordenada, como categor칤as de productos ordenadas por ventas). A medida que avanzas en la secuencia, el total acumulado incluye todos los valores anteriores m치s el valor actual.</p>

            <h3>Importancia del Total Acumulado:</h3>
            <ul>
                <li>An치lisis de Tendencias</li>
                <li>Seguimiento del Progreso</li>
                <li>Comparaciones</li>
            </ul>

            <h3>C치lculo de Totales Acumulados en DAX:</h3>
            <h4>1. Funciones de Inteligencia de Tiempo Est치ndar (para acumulados de tiempo):</h4>
            <ul>
                <li><strong>TOTALYTD:</strong>
                    <pre><code>Ventas YTD = TOTALYTD(SUM('Ventas'[Importe]), 'Calendario'[Fecha])</code></pre>
                </li>
                <li><strong>TOTALQTD:</strong>
                    <pre><code>Ventas QTD = TOTALQTD(SUM('Ventas'[Importe]), 'Calendario'[Fecha])</code></pre>
                </li>
                <li><strong>TOTALMTD:</strong>
                    <pre><code>Ventas MTD = TOTALMTD(SUM('Ventas'[Importe]), 'Calendario'[Fecha])</code></pre>
                </li>
            </ul>

            <h4>2. Uso de CALCULATE y FILTER para Acumulados Personalizados (m치s flexible):</h4>
            <ul>
                <li><strong>Patr칩n General para Acumulados sobre una Dimensi칩n Ordenada (ej. Tiempo):</strong>
                    <pre><code>Total Acumulado Personalizado =
VAR FechaMaximaVisible = MAX('Calendario'[Fecha]) // O la categor칤a m치xima visible
RETURN
    CALCULATE(
        SUM('Ventas'[Importe]), // O cualquier otra expresi칩n base
        FILTER(
            ALLSELECTED('Calendario'[Fecha]), // O ALL('Calendario'[Fecha])
            'Calendario'[Fecha] <= FechaMaximaVisible
        )
    )</code></pre>
                </li>
                <li><strong>Acumulado sobre una Categor칤a no Temporal:</strong>
                    <pre><code>Acumulado por Categoria =
VAR IndiceMaximoVisible = MAX('Productos'[IndiceCategoria])
RETURN
    CALCULATE(
        SUM('Ventas'[Importe]),
        FILTER(
            ALLSELECTED('Productos'[NombreCategoria], 'Productos'[IndiceCategoria]),
            'Productos'[IndiceCategoria] <= IndiceMaximoVisible
        )
    )</code></pre>
                </li>
            </ul>
            <div class="note">Los totales acumulados son una herramienta est치ndar en el reporting y an치lisis. Dominar sus diferentes formas de c치lculo en DAX te permitir치 presentar la informaci칩n de manera mucho m치s efectiva.</div>
        </section>



        <section id="clasificacionAbc" class="pagina">
            <h2>Clasificaci칩n ABC (An치lisis ABC)</h2>
            <p>La <strong>Clasificaci칩n ABC</strong> es un m칠todo de categorizaci칩n de elementos (como productos, clientes, art칤culos de inventario) en tres clases (A, B y C) basado en su importancia relativa seg칰n un criterio espec칤fico.</p>
            <ul>
                <li><strong>Clase A:</strong> Un peque침o porcentaje de elementos que representan un gran porcentaje del valor total (ej. el 20% de los productos que generan el 80% de las ventas).</li>
                <li><strong>Clase B:</strong> Un porcentaje intermedio de elementos que representan un porcentaje medio del valor (ej. el siguiente 30% de los productos que generan el 15% de las ventas).</li>
                <li><strong>Clase C:</strong> Un gran porcentaje de elementos que representan un peque침o porcentaje del valor (ej. el 50% de los productos que generan solo el 5% de las ventas).</li>
            </ul>

            <h3>Implementaci칩n de la Clasificaci칩n ABC en DAX:</h3>
            <p>Pasos T칤picos (ejemplo para clasificar Productos por Ventas):</p>
            <ol>
                <li><strong>Calcular la M칠trica por Elemento:</strong>
                    <pre><code>// Medida de Ventas
Total Ventas = SUM('Ventas'[Importe])</code></pre>
                </li>
                <li><strong>Calcular el Valor Acumulado de la M칠trica:</strong>
                    <pre><code>// Columna Calculada en la tabla 'Productos'
Ventas Acumuladas Producto =
VAR VentasProductoActual =
    CALCULATE(SUM('Ventas'[Importe]), 'Productos'[IDProducto] = EARLIER('Productos'[IDProducto]))
RETURN
    CALCULATE(
        SUMX(
            FILTER(
                ALL('Productos'),
                CALCULATE(SUM('Ventas'[Importe]), ALLEXCEPT('Productos', 'Productos'[IDProducto])) >= VentasProductoActual
            ),
            CALCULATE(SUM('Ventas'[Importe]), ALLEXCEPT('Productos', 'Productos'[IDProducto]))
        )
    )</code></pre>
                </li>
                <li><strong>Calcular el Porcentaje Acumulado del Valor Total:</strong>
                    <pre><code>// Medida o Variable (si se usa dentro de una columna calculada m치s grande)
Ventas Globales = CALCULATE(SUM('Ventas'[Importe]), ALL('Productos'))</code></pre>
                    <pre><code>// Columna Calculada en la tabla 'Productos'
Porcentaje Ventas Acumuladas =
VAR VentasDelProductoActual = CALCULATE(SUM('Ventas'[Importe]))
VAR VentasGlobalesTotales = CALCULATE(SUM('Ventas'[Importe]), ALL('Productos'))
VAR VentasAcumuladasHastaEsteProducto =
    SUMX(
        FILTER(
            ALL('Productos'),
            CALCULATE(SUM('Ventas'[Importe]), ALLEXCEPT('Productos', 'Productos'[IDProducto])) >= VentasDelProductoActual
        ),
        CALCULATE(SUM('Ventas'[Importe]), ALLEXCEPT('Productos', 'Productos'[IDProducto]))
    )
RETURN
    DIVIDE(VentasAcumuladasHastaEsteProducto, VentasGlobalesTotales)</code></pre>
                    <strong>Un Enfoque Alternativo y m치s Robusto (usando Ranking):</strong>
                    <pre><code>// Columna Calculada en 'Productos'
Ranking Ventas Producto =
RANKX(
    ALL('Productos'),
    CALCULATE(SUM('Ventas'[Importe])),
    , DESC, DENSE
)</code></pre>
                    <pre><code>// Columna Calculada en 'Productos'
Porcentaje Acumulado por Ranking =
VAR RankingActual = 'Productos'[Ranking Ventas Producto]
VAR VentasTotalesGlobales = CALCULATE(SUM('Ventas'[Importe]), ALL('Productos'))
VAR VentasAcumuladas =
    SUMX(
        FILTER(
            ALL('Productos'),
            'Productos'[Ranking Ventas Producto] <= RankingActual
        ),
        CALCULATE(SUM('Ventas'[Importe]))
    )
RETURN
    DIVIDE(VentasAcumuladas, VentasTotalesGlobales)</code></pre>
                </li>
                <li><strong>Asignar la Clase ABC:</strong>
                    <pre><code>// Columna Calculada en la tabla 'Productos'
Clase ABC =
VAR PorcentajeAcum = 'Productos'[Porcentaje Acumulado por Ranking]
RETURN
    SWITCH(
        TRUE(),
        PorcentajeAcum <= 0.80, "A",
        PorcentajeAcum <= 0.95, "B",
        "C"
    )</code></pre>
                </li>
            </ol>
            <div class="note">La Clasificaci칩n ABC es un patr칩n DAX potente que combina varias t칠cnicas (iteradores, ranking, l칩gica condicional) para obtener informaci칩n valiosa.</div>
        </section>



        <section id="calculosTiempo" class="pagina">
            <h2>C치lculos con Funciones de Tiempo (Inteligencia de Tiempo)</h2>
            <p>La <strong>inteligencia de tiempo</strong> en DAX se refiere al conjunto de funciones y t칠cnicas utilizadas para realizar c치lculos y comparaciones a lo largo de periodos de tiempo.</p>

            <h3>Requisito Fundamental: La Tabla de Calendario (Tabla de Fechas)</h3>
            <p>Es imprescindible tener una tabla de calendario bien construida en tu modelo de datos. Debe cumplir con:</p>
            <ul>
                <li>Columna de Fecha 칔nica</li>
                <li>Fechas Contiguas</li>
                <li>Cobertura Completa</li>
                <li>Marcar como Tabla de Fechas</li>
                <li>Columnas Adicionales 칔tiles</li>
            </ul>

            <h3>Funciones de Inteligencia de Tiempo Comunes:</h3>
            <ol>
                <li><strong>Acumulados (repaso r치pido):</strong> TOTALYTD(), TOTALQTD(), TOTALMTD()</li>
                <li><strong>Comparaciones con Periodos Anteriores:</strong>
                    <ul>
                        <li>SAMEPERIODLASTYEAR():
                            <pre><code>Ventas A침o Anterior = CALCULATE(SUM('Ventas'[Importe]), SAMEPERIODLASTYEAR('Calendario'[Fecha]))</code></pre>
                        </li>
                        <li>PREVIOUSYEAR(), PREVIOUSQUARTER(), PREVIOUSMONTH(), PREVIOUSDAY():
                            <pre><code>Ventas Mes Anterior = CALCULATE(SUM('Ventas'[Importe]), PREVIOUSMONTH('Calendario'[Fecha]))</code></pre>
                        </li>
                        <li>PARALLELPERIOD():
                            <pre><code>CALCULATE(SUM('Ventas'[Importe]), PARALLELPERIOD('Calendario'[Fecha], -3, YEAR))</code></pre>
                        </li>
                    </ul>
                </li>
                <li><strong>Desplazamiento de Fechas (Shifting Dates):</strong>
                    <ul>
                        <li>DATEADD():
                            <pre><code>CALCULATE(SUM('Ventas'[Importe]), DATEADD('Calendario'[Fecha], -7, DAY))</code></pre>
                        </li>
                    </ul>
                </li>
                <li><strong>Selecci칩n de Rangos de Fechas:</strong>
                    <ul>
                        <li>DATESINPERIOD():
                            <pre><code>CALCULATE(SUM('Ventas'[Importe]), DATESINPERIOD('Calendario'[Fecha], MAX('Calendario'[Fecha]), -30, DAY))</code></pre>
                        </li>
                        <li>DATESBETWEEN():
                            <pre><code>CALCULATE(SUM('Ventas'[Importe]), DATESBETWEEN('Calendario'[Fecha], DATE(2023,1,1), DATE(2023,3,31)))</code></pre>
                        </li>
                    </ul>
                </li>
                <li><strong>Obtener la Primera/칔ltima Fecha con Datos:</strong> FIRSTDATE(), LASTDATE(), FIRSTNONBLANK(), LASTNONBLANK()</li>
            </ol>

            <h3>Ejemplos de C치lculos Comunes:</h3>
            <ul>
                <li><strong>Crecimiento A침o sobre A침o (YoY Growth %):</strong>
                    <pre><code>Ventas YoY % =
VAR VentasActuales = SUM('Ventas'[Importe])
VAR VentasAnioAnterior =
    CALCULATE(
        SUM('Ventas'[Importe]),
        SAMEPERIODLASTYEAR('Calendario'[Fecha])
    )
RETURN
    IF(
        NOT ISBLANK(VentasAnioAnterior),
        DIVIDE(VentasActuales - VentasAnioAnterior, VentasAnioAnterior),
        BLANK()
    )</code></pre>
                </li>
                <li><strong>Crecimiento Mes sobre Mes (MoM Growth %):</strong>
                    <pre><code>Ventas MoM % =
VAR VentasMesActual = SUM('Ventas'[Importe])
VAR VentasMesAnterior =
    CALCULATE(
        SUM('Ventas'[Importe]),
        DATEADD('Calendario'[Fecha], -1, MONTH) // O PREVIOUSMONTH('Calendario'[Fecha])
    )
RETURN
    IF(
        NOT ISBLANK(VentasMesAnterior),
        DIVIDE(VentasMesActual - VentasMesAnterior, VentasMesAnterior),
        BLANK()
    )</code></pre>
                </li>
                <li><strong>Promedio M칩vil (ej. 3 meses):</strong>
                    <pre><code>Promedio Movil Ventas 3M =
VAR UltimaFechaVisible = MAX('Calendario'[Fecha])
VAR PeriodoTresMeses =
    DATESINPERIOD(
        'Calendario'[Fecha],
        UltimaFechaVisible,
        -3,
        MONTH
    )
RETURN
    CALCULATE(
        AVERAGEX(
            PeriodoTresMeses,
            CALCULATE(SUM('Ventas'[Importe]))
        ),
        REMOVEFILTERS('Calendario')
    )</code></pre>
                    Una forma m치s robusta y com칰n para promedios m칩viles que se muestran en un gr치fico de l칤nea a lo largo del tiempo ser칤a:
                    <pre><code>Promedio Movil Ventas 3M (Gr치fico) =
AVERAGEX(
    DATESINPERIOD(
        'Calendario'[Fecha],
        LASTDATE('Calendario'[Fecha]),
        -3,
        MONTH
    ),
    CALCULATE(SUM('Ventas'[Importe]))
)</code></pre>
                </li>
            </ul>
            <div class="note">Dominar las funciones de inteligencia de tiempo te permitir치 realizar an치lisis temporales profundos y significativos en tus informes de Power BI. Son una de las 치reas m치s poderosas de DAX.</div>
        </section>
<section id="quiz" class="pagina">
            <h2>
                <svg class="icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/></svg>
                Quiz Final: Pon a Prueba tus Conocimientos de DAX 游
            </h2>
            <p>춰Es hora de ver cu치nto has aprendido sobre DAX! Selecciona la respuesta que consideres correcta.</p>
            <form id="quizForm">
                <div class="quiz-container">
                    </div>
                <button type="button" id="quiz-submit-btn">Verificar Respuestas</button>
                <div id="quiz-result" style="display: none;"></div>
            </form>
        </section>
    </main>

    <footer>
        <p>&copy; <span id="currentYear"></span> Tutorial Power BI Intermedio - M칩dulo I: Lenguaje DAX. <br/> Un recurso de <span class="brand-name">Reinventa Consultor칤a y Capacitaci칩n</span>.</p>
    </footer>

    <script>
        // SPA Navigation
        const navLinks = document.querySelectorAll('nav a');
        const pages = document.querySelectorAll('.pagina');

        navLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                event.preventDefault();
                const targetId = link.getAttribute('data-target');

                pages.forEach(page => {
                    page.classList.remove('activa');
                    if (page.id === targetId) {
                        page.classList.add('activa');
                    }
                });

                navLinks.forEach(navLink => navLink.classList.remove('active-nav'));
                link.classList.add('active-nav');
                
                window.scrollTo({ top: document.querySelector('main').offsetTop - 20, behavior: 'smooth' });
            });
        });

        document.getElementById('currentYear').textContent = new Date().getFullYear();

        function highlightDaxCode() {
            const daxCodeBlocks = document.querySelectorAll('pre code.language-dax');
            daxCodeBlocks.forEach(block => {
                // Get the raw text content of the block
                let code = block.textContent;

                // Escape HTML characters to prevent issues when adding span tags
                code = code.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');

                // Apply syntax highlighting
                // Comments
                code = code.replace(/(--.*?)(\n|$)/g, '<span class="comment">$&</span>'); // Single line comments
                code = code.replace(/(\/\*[\s\S]*?\*\/)/g, '<span class="comment">$&</span>'); // Multi-line comments
                
                // Strings (ensure strings are processed before operators that might look like parts of strings)
                code = code.replace(/(".*?")/g, '<span class="string">$&</span>');
                code = code.replace(/('.*?')/g, '<span class="string">$&</span>'); // For table and column names with spaces

                // Keywords (case-insensitive, whole word match)
                code = code.replace(/\b(VAR|RETURN|TRUE|FALSE|BLANK|AND|OR|NOT|IN|ASC|DESC)\b/gi, '<span class="keyword">$&</span>');
                
                // Functions (case-insensitive, whole word match, before column/table names)
                code = code.replace(/\b(SUM|SUMX|AVERAGE|AVERAGEX|MIN|MINX|MAX|MAXX|COUNT|COUNTROWS|DISTINCTCOUNT|CALCULATE|FILTER|ALL|ALLEXCEPT|ALLSELECTED|KEEPFILTERS|RELATED|RELATEDTABLE|DIVIDE|VALUES|SELECTEDVALUE|GENERATESERIES|TOTALYTD|TOTALMTD|TOTALQTD|SAMEPERIODLASTYEAR|PREVIOUSYEAR|PREVIOUSMONTH|PREVIOUSQUARTER|DATEADD|DATESBETWEEN|DATESINPERIOD|STARTOFYEAR|ENDOFYEAR|RANKX|ADDCOLUMNS|SUMMARIZE|USERELATIONSHIP|FORMAT|IF|SWITCH|ISBLANK|IFERROR|REMOVEFILTERS)\b/gi, '<span class="function">$&</span>');

                // Table and Column Names (process after functions, before variables if they look similar)
                // Tables: 'TableName' (single quotes)
                code = code.replace(/('[\w\s\$\%\&\*\@\#\.\-\/\\]+')/g, '<span class="table">$&</span>'); 
                // Columns: [Column Name] (square brackets)
                code = code.replace(/(\[[\w\s\$\%\&\*\@\#\.\-\/\\]+?\])/g, '<span class="column">$&</span>');

                // Variable names (after VAR keyword, can be tricky with `$&` in regex)
                // Look for 'VAR ' followed by a word, but not if it's already a keyword or function.
                // This one needs careful handling as `$&` can refer to the whole match.
                // Let's refine the variable replacement to be more specific.
                code = code.replace(/(<span class="keyword">VAR<\/span>)((\s+)([a-zA-Z_]\w*))/g, '$1$3<span class="variableName">$4</span>');
                
                // Numbers
                code = code.replace(/\b(\d+\.?\d*|\.\d+)\b/g, '<span class="number">$&</span>');
                
                // Operators (ensure special characters are escaped in regex)
                code = code.replace(/(&amp;&amp;|\|\||&lt;=|&gt;=|[=+\-*\/%^&amp;])/g, '<span class="operator">$&</span>');


                block.innerHTML = code;
            });
        }
        highlightDaxCode(); 

        const quizData = [
            {
                question: "En DAX, 쯖u치l es la principal diferencia entre el contexto de fila y el contexto de filtro?",
                options: [
                    "A) El contexto de fila solo existe en columnas calculadas y el de filtro solo en medidas.",
                    "B) El contexto de fila itera fila por fila y permite acceso directo a valores de columna de la fila actual; el contexto de filtro es el conjunto de filtros activos que acotan los datos antes de una agregaci칩n.",
                    "C) El contexto de filtro siempre anula el contexto de fila cuando ambos est치n presentes.",
                    "D) El contexto de fila se usa para filtrar tablas y el contexto de filtro para crear nuevas columnas."
                ],
                answer: "B)",
                explanation: "El contexto de fila permite c치lculos a nivel de fila, mientras que el contexto de filtro define qu칠 subconjunto de datos se considera para una medida. Ambos pueden coexistir e interactuar, especialmente con CALCULATE (transici칩n de contexto)."
            },
            {
                question: "Dada la medida: `Ventas LY = CALCULATE(SUM('Ventas'[Monto]), SAMEPERIODLASTYEAR('Calendario'[Fecha]))`. Si se usa en una matriz con Meses en las filas, 쯤u칠 hace `SAMEPERIODLASTYEAR('Calendario'[Fecha])`?",
                options: [
                    "A) Filtra la tabla 'Ventas' para incluir solo las ventas del a침o anterior completo.",
                    "B) Modifica el contexto de filtro para que `SUM('Ventas'[Monto])` se eval칰e sobre las fechas del mismo per칤odo (ej. mismo mes) pero del a침o anterior.",
                    "C) Devuelve el valor de 'Ventas'[Monto] de la misma fecha exacta del a침o pasado.",
                    "D) Crea una nueva tabla 'Calendario' con las fechas del a침o anterior."
                ],
                answer: "B)",
                explanation: "SAMEPERIODLASTYEAR es una funci칩n de manipulaci칩n de contexto que toma el conjunto de fechas actual en el contexto de filtro y lo desplaza un a침o atr치s, permitiendo que la expresi칩n (SUM) se calcule sobre ese nuevo conjunto de fechas."
            },
            {
                question: "Considera la expresi칩n DAX: `VAR TotalIngresos = SUM('Ventas'[Ingresos]) RETURN IF(TotalIngresos > 1000, TotalIngresos * 0.1, 0)`. 쮺u치l es la principal ventaja de usar la variable `TotalIngresos` aqu칤?",
                options: [
                    "A) Permite que `SUM('Ventas'[Ingresos])` se calcule dos veces, una para la condici칩n y otra para el resultado, asegurando precisi칩n.",
                    "B) Mejora significativamente la velocidad de actualizaci칩n del modelo de datos.",
                    "C) Aumenta el tama침o del archivo PBIX al almacenar el valor de la variable.",
                    "D) Mejora la legibilidad y asegura que `SUM('Ventas'[Ingresos])` se calcule una sola vez, optimizando el rendimiento de la medida."
                ],
                answer: "D)",
                explanation: "Las variables en DAX (VAR...RETURN) calculan la expresi칩n asignada una sola vez y almacenan su resultado para ser reutilizado. Esto mejora la legibilidad y puede optimizar el rendimiento si la expresi칩n es compleja o se usa m칰ltiples veces."
            },
            {
                question: "Para un an치lisis ABC de productos, necesitas calcular el porcentaje acumulado de ventas. 쯈u칠 combinaci칩n de funciones DAX es m치s adecuada para obtener el total de ventas de productos 'mejores o iguales' al producto actual en t칠rminos de ventas, para luego calcular el acumulado?",
                options: [
                    "A) `SUMX(FILTER('Productos', 'Productos'[Ventas] >= CURRENT()), 'Productos'[Ventas])` donde CURRENT() es el producto actual.",
                    "B) `CALCULATE(SUM('Ventas'[Monto]), FILTER(ALL('Productos'), RANKX(ALL('Productos'), CALCULATE(SUM('Ventas'[Monto])), , DESC) <= RANKX(VALUES('Productos'), CALCULATE(SUM('Ventas'[Monto])), , DESC)))`",
                    "C) `TOTALYTD(SUM('Ventas'[Monto]), 'Productos'[FechaLanzamiento])`",
                    "D) `RELATEDTABLE('Ventas')` y luego un `SUMX`."
                ],
                answer: "B)",
                explanation: "La opci칩n B, aunque compleja, describe la l칩gica de rankear todos los productos, obtener el ranking del producto actual en contexto, y luego sumar las ventas de todos los productos cuyo ranking sea menor o igual al actual. Esto es un enfoque com칰n para acumulados en an치lisis ABC. La A es conceptualmente correcta pero `CURRENT()` no es una funci칩n DAX. C es para inteligencia de tiempo. D no realiza el acumulado por ranking."
            },
            {
                question: "Al usar una tabla param칠trica (What-if) para simular un descuento porcentual, la tabla del par치metro (`'Descuento % Tabla'`) no tiene relaciones con la tabla de `Ventas`. 쮺칩mo se utiliza el valor seleccionado del segmentador del par치metro en una medida que calcula `Ventas con Descuento`?",
                options: [
                    "A) Creando una relaci칩n activa entre `'Descuento % Tabla'` y `'Ventas'` basada en una columna com칰n.",
                    "B) Usando `RELATED('Descuento % Tabla'[Valor])` dentro de la medida de `Ventas con Descuento`.",
                    "C) Usando `SELECTEDVALUE('Descuento % Tabla'[Valor])` para capturar el valor del par치metro y aplic치ndolo matem치ticamente a las ventas.",
                    "D) Agregando una columna calculada a la tabla `Ventas` que use `LOOKUPVALUE` para traer el valor del par치metro."
                ],
                answer: "C)",
                explanation: "Las tablas param칠tricas son desconectadas. El valor seleccionado en su segmentador se captura con `SELECTEDVALUE` (o `MIN`/`MAX`/`AVERAGE` si se permite selecci칩n m칰ltiple y se quiere un comportamiento espec칤fico) y luego se usa aritm칠ticamente dentro de las medidas que necesitan ese par치metro."
            }
        ];

        const quizContainer = document.querySelector('.quiz-container');
        const quizForm = document.getElementById('quizForm');
        const submitButton = document.getElementById('quiz-submit-btn');
        const quizResultDiv = document.getElementById('quiz-result');

        function renderQuiz() {
            let quizHTML = '';
            quizData.forEach((q, index) => {
                quizHTML += `
                    <div class="question-block" id="question-${index}">
                        <p>${index + 1}. ${q.question}</p>
                        <div class="options">
                `;
                q.options.forEach(optionText => { 
                    const optionValue = optionText.substring(0, optionText.indexOf(')') + 1); 
                    quizHTML += `
                        <label>
                            <input type="radio" name="question${index}" value="${optionValue}"> 
                            ${optionText}
                        </label>
                    `;
                });
                quizHTML += `
                        </div>
                        <div class="feedback" id="feedback-${index}">
                            <strong>Explicaci칩n:</strong> ${q.explanation}
                        </div>
                    </div>
                `;
            });
            quizContainer.innerHTML = quizHTML;
        }
        
        renderQuiz();

        quizData.forEach((q, index) => {
            const radioButtons = document.querySelectorAll(`input[name="question${index}"]`);
            const feedbackDiv = document.getElementById(`feedback-${index}`);
            
            radioButtons.forEach(radio => {
                radio.addEventListener('change', () => {
                    // Hide feedback and reset styles when a new option is selected
                    feedbackDiv.style.display = 'none';
                    feedbackDiv.classList.remove('correct', 'incorrect');
                    
                    radioButtons.forEach(rb => {
                        rb.disabled = true; // Disable all radio buttons for this question after one selection
                        rb.parentElement.style.backgroundColor = '#f0f0f0';
                        rb.parentElement.style.border = 'none';
                        rb.parentElement.style.fontWeight = 'normal'; // Reset font-weight
                    });

                    if (radio.value === q.answer ) { 
                        feedbackDiv.classList.add('correct');
                        radio.parentElement.style.backgroundColor = '#d4edda';
                        radio.parentElement.style.border = '2px solid var(--success-color)';
                    } else {
                        feedbackDiv.classList.add('incorrect');
                        radio.parentElement.style.backgroundColor = '#f8d7da';
                        radio.parentElement.style.border = '2px solid var(--danger-color)';
                        // Highlight the correct answer if the selected one is incorrect
                        radioButtons.forEach(rb => {
                            if (rb.value === q.answer) {
                                rb.parentElement.style.backgroundColor = '#d4edda';
                                rb.parentElement.style.fontWeight = 'bold';
                            }
                        });
                    }
                    feedbackDiv.style.display = 'block';
                });
            });
        });

        submitButton.addEventListener('click', () => {
            let score = 0;
            quizData.forEach((q, index) => {
                const selectedOption = document.querySelector(`input[name="question${index}"]:checked`);
                const feedbackDiv = document.getElementById(`feedback-${index}`);
                
                // Show feedback for all questions when submit is clicked, even if not answered
                if (selectedOption && selectedOption.value === q.answer) {
                    score++;
                }
                
                // Ensure feedback is displayed for all questions
                if (feedbackDiv.style.display !== 'block'){
                    // If no option was selected, mark it as incorrect (or handle as 'unanswered')
                    if (!selectedOption) {
                        feedbackDiv.classList.add('incorrect'); // Assume incorrect if not answered
                        feedbackDiv.style.display = 'block';
                    }
                }
            });

            quizResultDiv.innerHTML = `Has acertado ${score} de ${quizData.length} preguntas.`;
            quizResultDiv.style.display = 'block';
            if (score >= quizData.length * 0.6) { 
                quizResultDiv.className = 'success';
            } else {
                quizResultDiv.className = 'fail';
            }
        });

    </script>
</body>
</html>
